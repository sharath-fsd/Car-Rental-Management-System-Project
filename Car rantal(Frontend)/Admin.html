<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard - Car Control</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding-top: 60px;
      background: #f4f4f4;
    }

    /* Navbar */
    .admin-nav {
      position: fixed;
      top: 0;
      left: 0;
      width: 97%;
      background: #333;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 30px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      z-index: 1000;
    }

    .admin-nav h1 {
      font-size: 20px;
      margin: 0;
      color: gold;
    }

    .admin-nav .nav-links a {
      margin-left: 20px;
      text-decoration: none;
      color: #eee;
      font-weight: 500;
      transition: color 0.3s ease;
    }

    .admin-nav .nav-links a:hover {
      color: gold;
    }

    /* Page Content */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 20px;
    }

    .message-link {
      padding: 10px 16px;
      background-color: #007bff;
      color: white;
      text-decoration: none;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: background-color 0.3s ease;
    }

    .message-link:hover {
      background-color: #0056b3;
    }

    form {
      background: #fff;
      padding: 20px;
      border-radius: 6px;
      margin: 0 auto 30px;
      max-width: 600px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }

    form input {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    button {
      padding: 10px 20px;
      background: #28a745;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }

    button.delete {
      background: #dc3545;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: center;
    }

    img {
      width: 60px;
      height: 40px;
      object-fit: cover;
      border-radius: 4px;
    }
  </style>
</head>
<body>

  <!-- ‚úÖ Admin Navigation Bar -->
  <div class="admin-nav">
    <h1>Admin Dashboard</h1>
    <div class="nav-links">
      <a href="Interface.html">Home</a>
      <a href="Service.html">Service</a>
      <a href="About.html">About</a>
      <a href="Contact.html">Contact</a>
      <a href="Inside.html">Car_page</a>

    </div>
  </div>

  <!-- ‚úÖ Admin Panel Content -->
  <div class="top-bar">
    <h2>Manage Cars</h2>
    <a class="message-link" href="admin_messages.html">üì® View Contact Messages</a>
  </div>

  <form id="addCarForm">
    <input type="text" id="name" placeholder="Car Name (e.g. Swift AT)" required />
    <input type="text" id="brand" placeholder="Brand (e.g. Maruti)" required />
    <input type="text" id="fuel" placeholder="Fuel Type (Petrol/Diesel)" required />
    <input type="number" id="seats" placeholder="Seats (e.g. 5)" required />
    <input type="number" id="rentPerDay" placeholder="Rent per day (e.g. 4368)" required />
    
    <input type="file" id="imageUpload" accept="image/*" />
    <input type="text" id="image" placeholder="Image filename" readonly required />
    <button type="submit">Add Car</button>
  </form>

  <table id="carTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Brand</th>
        <th>Fuel</th>
        <th>Seats</th>
        <th>Rent</th>
        <th>Image</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API = "http://localhost:8080/api/cars";

    document.getElementById("imageUpload").addEventListener("change", function () {
      const file = this.files[0];
      if (!file) return;

      const formData = new FormData();
      formData.append("file", file);

      fetch("http://localhost:8080/api/upload", {
        method: "POST",
        body: formData
      })
        .then(res => res.text())
        .then(filename => {
          if (filename.startsWith("‚ùå")) {
            alert(filename);
          } else {
            document.getElementById("image").value = filename;
            alert("‚úÖ Uploaded: " + filename);
          }
        })
        .catch(() => alert("‚ùå Upload failed."));
    });

    function loadCars() {
      fetch(API)
        .then(res => res.json())
        .then(cars => {
          const tbody = document.querySelector("#carTable tbody");
          tbody.innerHTML = "";
          cars.forEach(car => {
            const imagePath = car.image ? `http://localhost:8080/uploads/${car.image}` : "default.png";
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${car.name}</td>
              <td>${car.brand}</td>
              <td>${car.fuel}</td>
              <td>${car.seats}</td>
              <td>‚Çπ${car.rentPerDay}</td>
              <td><img src="${imagePath}" alt="${car.name}" /></td>
              <td><button class="delete" onclick="deleteCar(${car.id})">Delete</button></td>
            `;
            tbody.appendChild(row);
          });
        })
        .catch(() => alert("üö´ Could not fetch cars from server."));
    }

    document.getElementById("addCarForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const car = {
        name: document.getElementById("name").value.trim(),
        brand: document.getElementById("brand").value.trim(),
        fuel: document.getElementById("fuel").value.trim(),
        seats: parseInt(document.getElementById("seats").value),
        rentPerDay: parseFloat(document.getElementById("rentPerDay").value),
        image: document.getElementById("image").value.trim()
      };

      fetch(API, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(car)
      })
        .then(res => {
          if (res.ok) {
            document.getElementById("addCarForm").reset();
            document.getElementById("image").value = "";
            loadCars();
            alert("‚úÖ Car added successfully.");
          } else {
            alert("üö´ Failed to add car.");
          }
        })
        .catch(() => alert("‚ùå Server error while adding car."));
    });

    function deleteCar(id) {
      if (!confirm("Are you sure you want to delete this car?")) return;

      fetch(`${API}/${id}`, {
        method: "DELETE"
      })
        .then(res => {
          if (res.ok) {
            loadCars();
          } else {
            alert("‚ùå Failed to delete car.");
          }
        })
        .catch(() => alert("‚ùå Could not connect to server."));
    }

    loadCars();
  </script>
</body>
</html>
